name: Build and Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version (e.g., v1.0.0)'
        required: true
        default: 'v0.0.3-alpha'

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - uses: ilammy/msvc-dev-cmd@v1
      
    - name: Build
      run: |
        mkdir build
        cl.exe /nologo /Fe:build\ottsr.exe /O2 /MD src\ottsr.c /link /SUBSYSTEM:WINDOWS user32.lib gdi32.lib kernel32.lib comctl32.lib winmm.lib
        
    - name: Package
      run: |
        powershell -Command "Compress-Archive -Path 'build\ottsr.exe' -DestinationPath 'ottsr-${{ github.event.inputs.version }}.zip'"
        
    - name: Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ github.event.inputs.version }}
        files: ottsr-${{ github.event.inputs.version }}.zip
