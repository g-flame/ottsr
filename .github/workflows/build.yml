name: Build & Release Enhanced Study Reminder
on:
  workflow_dispatch:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup MSVC Environment
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: x64
          
      - name: Build Enhanced Study Reminder (MSVC Optimized)
        shell: cmd
        run: |
          echo Building Enhanced Study Reminder System...
          cl /nologo /O2 /GL /Gy /arch:AVX2 /fp:fast /MD ^
             /DWIN32_LEAN_AND_MEAN /D_CRT_SECURE_NO_WARNINGS ^
             study-remainder-ott.c ^
             /Fe:StudyReminderEnhanced.exe ^
             user32.lib kernel32.lib shell32.lib winmm.lib ^
             opengl32.lib glu32.lib gdi32.lib comctl32.lib ^
             psapi.lib advapi32.lib ^
             /link /LTCG /SUBSYSTEM:WINDOWS
             
      - name: Build Console Version (Alternative)
        shell: cmd
        run: |
          echo Building Console Version...
          cl /nologo /O2 /GL /Gy /arch:AVX2 /fp:fast /MD ^
             /DWIN32_LEAN_AND_MEAN /D_CRT_SECURE_NO_WARNINGS ^
             /DCONSOLE_MODE ^
             study-remainder-ott.c ^
             /Fe:StudyReminderConsole.exe ^
             user32.lib kernel32.lib shell32.lib winmm.lib ^
             opengl32.lib glu32.lib gdi32.lib comctl32.lib ^
             psapi.lib advapi32.lib ^
             /link /LTCG /SUBSYSTEM:CONSOLE
             
      - name: Create Default Config
        shell: cmd
        run: |
          echo # ENHANCED UNIVERSAL STUDY REMINDER CONFIG v2.0 > study_reminder.conf
          echo # MAXIMUM OVERKILL EDITION WITH GUI >> study_reminder.conf
          echo. >> study_reminder.conf
          echo SUBJECT=Dominating My Studies >> study_reminder.conf
          echo REMINDER_INTERVAL=25 >> study_reminder.conf
          echo APP_CHECK_INTERVAL=10 >> study_reminder.conf
          echo ENABLE_FLASH=1 >> study_reminder.conf
          echo ENABLE_SHAKE=1 >> study_reminder.conf
          echo ENABLE_SOUND=1 >> study_reminder.conf
          echo ENABLE_OPENGL=1 >> study_reminder.conf
          echo ENABLE_APP_MONITORING=1 >> study_reminder.conf
          echo ENABLE_HARDCORE_MODE=0 >> study_reminder.conf
          echo ENABLE_DARK_MODE=1 >> study_reminder.conf
          
      - name: Create README
        shell: cmd
        run: |
          echo # 🔥 Enhanced Universal Study Reminder System v2.0 🔥 > README.txt
          echo. >> README.txt
          echo ## MAXIMUM OVERKILL EDITION WITH GUI >> README.txt
          echo. >> README.txt
          echo ### 🚀 EPIC FEATURES: >> README.txt
          echo - Dark Mode GUI Interface >> README.txt
          echo - Real-time App Monitoring >> README.txt
          echo - Advanced OpenGL Visualization >> README.txt
          echo - Achievement System >> README.txt
          echo - Productivity Analytics >> README.txt
          echo - Hardcore Focus Mode >> README.txt
          echo - Session Tracking >> README.txt
          echo. >> README.txt
          echo ### 📋 HOW TO USE: >> README.txt
          echo 1. Run StudyReminderEnhanced.exe for GUI version >> README.txt
          echo 2. Run StudyReminderConsole.exe for console version >> README.txt
          echo 3. Configure your study subject and preferences >> README.txt
          echo 4. Hit "🚀 START DOMINATION" button >> README.txt
          echo 5. CRUSH YOUR STUDIES! 💪 >> README.txt
          echo. >> README.txt
          echo ### ⚙️ CONFIGURATION: >> README.txt
          echo Edit study_reminder.conf to customize: >> README.txt
          echo - Study subjects and messages >> README.txt
          echo - App monitoring lists >> README.txt
          echo - Visual and audio effects >> README.txt
          echo - Achievement thresholds >> README.txt
          echo. >> README.txt
          echo ### 🎯 HARDCORE MODE: >> README.txt
          echo WARNING: Enables automatic termination of blocked apps! >> README.txt
          echo Use responsibly for maximum focus! >> README.txt
          echo. >> README.txt
          echo ### 📁 FILES: >> README.txt
          echo - study_reminder.conf : Main configuration >> README.txt
          echo - session.txt : Session data storage >> README.txt
          echo - session_log.txt : Detailed session history >> README.txt
          echo. >> README.txt
          echo 🔥 UNLEASH YOUR ACADEMIC BEAST MODE! 🔥 >> README.txt
          
      - name: Verify Build
        shell: cmd
        run: |
          echo Verifying builds...
          if exist StudyReminderEnhanced.exe (
            echo ✅ GUI Version built successfully
            dir StudyReminderEnhanced.exe
          ) else (
            echo ❌ GUI Version build failed
          )
          
          if exist StudyReminderConsole.exe (
            echo ✅ Console Version built successfully  
            dir StudyReminderConsole.exe
          ) else (
            echo ❌ Console Version build failed
          )
          
      - name: Create Release Package
        shell: powershell
        run: |
          # Create release directory
          New-Item -ItemType Directory -Force -Path "StudyReminderPackage"
          
          # Copy files to package
          Copy-Item "StudyReminderEnhanced.exe" "StudyReminderPackage/"
          Copy-Item "StudyReminderConsole.exe" "StudyReminderPackage/"
          Copy-Item "study_reminder.conf" "StudyReminderPackage/"
          Copy-Item "README.txt" "StudyReminderPackage/"
          
          # Create batch launcher
          @'
          @echo off
          echo 🔥 ENHANCED STUDY REMINDER LAUNCHER 🔥
          echo.
          echo Choose your weapon:
          echo 1. GUI Version (Recommended)
          echo 2. Console Version
          echo 3. Exit
          echo.
          set /p choice="Enter your choice (1-3): "
          
          if "%choice%"=="1" (
              echo Starting GUI version...
              start StudyReminderEnhanced.exe
          ) else if "%choice%"=="2" (
              echo Starting Console version...
              start StudyReminderConsole.exe
          ) else if "%choice%"=="3" (
              echo Goodbye! Keep studying! 📚
              exit
          ) else (
              echo Invalid choice. Try again.
              goto :start
          )
          '@ | Out-File -FilePath "StudyReminderPackage/LAUNCHER.bat" -Encoding ascii
          
          # Create zip package
          Compress-Archive -Path "StudyReminderPackage/*" -DestinationPath "EnhancedStudyReminder-v2.0.zip"
          
      - name: Upload GUI Version to Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v2.0-enhanced
          release_name: "🔥 Enhanced Study Reminder v2.0 - Maximum Overkill Edition 🔥"
          body: |
            ## 🚀 STUDY DOMINATION SYSTEM v2.0 🚀
            
            ### NEW EPIC FEATURES:
            - 🌙 **Dark Mode GUI Interface** - Sleek and modern
            - 👀 **Real-time App Monitoring** - Detects distractions instantly
            - ✨ **Advanced OpenGL Visualization** - Epic visual effects
            - 🏆 **Achievement System** - Gamified learning experience
            - 📊 **Productivity Analytics** - Track your focus score
            - 💀 **Hardcore Mode** - Auto-terminates blocked apps
            - 🎯 **Session Persistence** - Never lose your progress
            
            ### 📦 WHAT'S INCLUDED:
            - `StudyReminderEnhanced.exe` - Main GUI application
            - `StudyReminderConsole.exe` - Console version
            - `study_reminder.conf` - Configuration file
            - `README.txt` - Complete documentation
            - `LAUNCHER.bat` - Easy launcher script
            
            ### 🔥 HARDCORE FEATURES:
            - **Real-time process monitoring**
            - **Automatic distraction blocking**
            - **Epic OpenGL animations**
            - **Achievement unlocking system**
            - **Productivity score tracking**
            
            ### ⚠️ SYSTEM REQUIREMENTS:
            - Windows 10/11
            - OpenGL support
            - Admin rights (for hardcore mode)
            
            **UNLEASH YOUR ACADEMIC BEAST MODE!** 💪🔥
            
          files: |
            StudyReminderEnhanced.exe
            StudyReminderConsole.exe
            EnhancedStudyReminder-v2.0.zip
            study_reminder.conf
            README.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Build Status Summary
        shell: cmd
        run: |
          echo.
          echo ================================
          echo 🔥 BUILD COMPLETE! 🔥
          echo ================================
          echo.
          echo ✅ Enhanced Study Reminder built successfully!
          echo ✅ Both GUI and Console versions ready
          echo ✅ Configuration files created
          echo ✅ Release package assembled
          echo.
          echo 🚀 Ready to dominate your studies!
          echo 💪 Time to unleash your potential!
          echo.
          echo Files created:
          dir *.exe
          dir *.conf
          dir *.txt
          dir *.zip
          echo.
          echo ================================
